# å¾®å‰ç«¯åº”ç”¨é…ç½®è¯´æ˜

## æ¦‚è¿°

æœ¬é…ç½®ç³»ç»Ÿå°†å­åº”ç”¨çš„é…ç½®ä»ä¸šåŠ¡ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæä¾›äº†ç®€åŒ–çš„é…ç½®ç®¡ç†æ–¹å¼ã€‚ä½¿ç”¨anyç±»å‹ï¼Œæ— å¼ºç±»å‹æ£€æŸ¥ï¼Œæ‰€æœ‰é…ç½®é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

## é…ç½®æ–‡ä»¶ç»“æ„

```
src/config/
â”œâ”€â”€ index.ts           # é…ç½®ç®¡ç†å™¨ä¸»å…¥å£
â”œâ”€â”€ app.config.ts      # ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼ˆä¸»åº”ç”¨+å­åº”ç”¨ï¼‰
â””â”€â”€ README.md          # æœ¬è¯´æ˜æ–‡æ¡£
```

## é…ç½®è¯´æ˜

æ‰€æœ‰é…ç½®éƒ½åœ¨ `app.config.ts` æ–‡ä»¶ä¸­ï¼Œç°åœ¨é‡‡ç”¨ç»Ÿä¸€çš„èœå•é…ç½®ç»“æ„ï¼š

- `childApps`: å­åº”ç”¨å¾®å‰ç«¯é…ç½®æ•°ç»„ï¼ˆåªåŒ…å«å¾®å‰ç«¯ç›¸å…³é…ç½®ï¼‰
- `menuConfig`: ç»Ÿä¸€èœå•é…ç½®æ•°ç»„ï¼ˆæ”¯æŒä»»æ„çº§åˆ«èœå•ï¼Œæ··åˆä¸»åº”ç”¨å’Œå­åº”ç”¨é¡µé¢ï¼‰

## å­åº”ç”¨å¾®å‰ç«¯é…ç½®ç»“æ„

æ¯ä¸ªå­åº”ç”¨å¾®å‰ç«¯é…ç½®åŒ…å«ä»¥ä¸‹å­—æ®µï¼ˆåªä¿ç•™å®é™…ä½¿ç”¨çš„å­—æ®µï¼‰ï¼š

```javascript
{
  name: 'child-one',           // å­åº”ç”¨åç§°ï¼Œå­åº”ç”¨ä¹‹é—´åç§°ä¸èƒ½é‡å¤
  url: 'http://localhost:8001',  // å­åº”ç”¨åŸºç¡€URLï¼Œå¦‚æœå’Œä¸»åº”ç”¨å­˜åœ¨è·¨åŸŸï¼Œè¯·åœ¨å­åº”ç”¨ä¸­æ·»åŠ å…è®¸è·¨åŸŸï¼Œä»¥ä¾¿äºå¼€å‘ï¼Œvite é¡¹ç›®å¯å¿½ç•¥
  iframe: true,                // æ˜¯å¦ä½¿ç”¨iframeæ¨¡å¼ï¼Œvite åº”ç”¨å¿…é¡»è®¾ç½®ä¸º true
  routePrefix: '/child-one',   // è·¯ç”±å‰ç¼€ï¼Œå­åº”ç”¨ä¹‹é—´åç§°ä¸èƒ½é‡å¤ï¼Œæ¨è /+name
  port: 8001,                  // ç«¯å£å·ï¼Œå¼€å‘æ—¶é¡¹ç›®å¯åŠ¨çš„ç«¯å£å·
  enabled: true,               // æ˜¯å¦å¯ç”¨
  keepAlive: true,             // æ˜¯å¦å¯ç”¨keep-aliveç¼“å­˜ï¼Œæé«˜æ€§èƒ½

  // micro-app ç»„ä»¶çš„é¢å¤–å±æ€§ï¼ˆä¼šè‡ªåŠ¨ä¼ é€’ç»™ micro-app ç»„ä»¶ï¼‰
  'disable-memory-router': false, // æ˜¯å¦ç¦ç”¨è™šæ‹Ÿè·¯ç”±ç³»ç»Ÿ
  'disable-patch-request': false, // æ˜¯å¦ç¦ç”¨è¯·æ±‚æ‹¦æˆª
  'inline': false,             // æ˜¯å¦ä½¿ç”¨å†…è”æ¨¡å¼
  'destroy': false,            // æ˜¯å¦åœ¨å¸è½½æ—¶é”€æ¯
  // å¯ä»¥æ·»åŠ ä»»ä½• micro-app æ”¯æŒçš„å±æ€§...
}
```

**åŠ¨æ€å±æ€§ç»‘å®š**ï¼š

- é™¤äº† `enabled`ã€`port`ã€`routePrefix`ã€`url` ç­‰é…ç½®ç®¡ç†ç›¸å…³çš„å­—æ®µå¤–ï¼Œå…¶ä»–æ‰€æœ‰å­—æ®µéƒ½ä¼šè‡ªåŠ¨ä¼ é€’ç»™ `micro-app` ç»„ä»¶
- ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ `...microAppAttributes` å®ç°åŠ¨æ€ç»‘å®š
- `name` å’Œ `url` ä¼šè¢«è‡ªåŠ¨è®¡ç®—ï¼Œæ— éœ€åœ¨é…ç½®ä¸­æŒ‡å®š
- æ–°å¢ä»»ä½• micro-app æ”¯æŒçš„å±æ€§éƒ½ä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œæ— éœ€ä¿®æ”¹æ¨¡æ¿ä»£ç 

## ç»Ÿä¸€èœå•é…ç½®ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰

æ–°çš„èœå•é…ç½®æ”¯æŒä»»æ„çº§åˆ«çš„èœå•åµŒå¥—ï¼Œæ¯ä¸ªèœå•é¡¹å¯ä»¥ç‹¬ç«‹æŒ‡å®šæ˜¯ä¸»åº”ç”¨é¡µé¢è¿˜æ˜¯å­åº”ç”¨é¡µé¢ã€‚
**ä¼˜åŒ–ç‰¹æ€§**ï¼š

- ğŸš€ **è‡ªåŠ¨ç”Ÿæˆkey**ï¼šä½¿ç”¨ `path` ä½œä¸º `key`ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š
- ğŸ”„ **è‡ªåŠ¨æ¨å¯¼childPath**ï¼šä» `path` è‡ªåŠ¨æ¨å¯¼å‡º `childPath`ï¼Œå‡å°‘é…ç½®å†—ä½™

### ä¸»åº”ç”¨é¡µé¢é…ç½®

```javascript
{
  label: 'ä¸»åº”ç”¨é¦–é¡µ',          // èœå•æ˜¾ç¤ºåç§°
  path: '/home',               // è·¯ç”±è·¯å¾„ï¼ˆè‡ªåŠ¨ä½œä¸ºkeyä½¿ç”¨ï¼‰
  icon: 'HomeOutlined',        // å›¾æ ‡åç§°
  type: 'main',                // é¡µé¢ç±»å‹ï¼šä¸»åº”ç”¨é¡µé¢
}
```

### å­åº”ç”¨é¡µé¢é…ç½®

```javascript
{
  label: 'é¦–é¡µ',               // èœå•æ˜¾ç¤ºåç§°
  path: '/child-one/home',     // ä¸»åº”ç”¨ä¸­çš„è·¯ç”±è·¯å¾„ï¼ˆè‡ªåŠ¨ä½œä¸ºkeyä½¿ç”¨ï¼‰
  icon: 'HomeOutlined',        // å›¾æ ‡åç§°
  type: 'micro',               // é¡µé¢ç±»å‹ï¼šå­åº”ç”¨é¡µé¢
  appName: 'child-one',        // å¯¹åº”çš„å­åº”ç”¨åç§°
  // childPath å°†è‡ªåŠ¨ä» path æ¨å¯¼ï¼š/child-one/home -> /home
}
```

**childPathè‡ªåŠ¨æ¨å¯¼è§„åˆ™**ï¼š

- `/child-one/home` â†’ `childPath: '/home'`
- `/child-one/about` â†’ `childPath: '/about'`
- `/child-one/` â†’ `childPath: '/'`
- `/child-two/manage/user` â†’ `childPath: '/manage/user'`

### å¤šçº§èœå•é…ç½®

```javascript
{
  label: 'ç³»ç»Ÿç®¡ç†',           // èœå•ç»„æ— éœ€pathï¼Œè‡ªåŠ¨ç”Ÿæˆéšæœºkey
  icon: 'SettingOutlined',
  children: [                  // æ”¯æŒä»»æ„çº§åˆ«åµŒå¥—
    {
      label: 'ç³»ç»Ÿè®¾ç½®',
      path: '/system/settings', // ä¸»åº”ç”¨é¡µé¢ï¼Œpathè‡ªåŠ¨ä½œä¸ºkey
      icon: 'SettingOutlined',
      type: 'main',            // ä¸»åº”ç”¨é¡µé¢
    },
    {
      label: 'ç”¨æˆ·ä¸­å¿ƒ',
      path: '/child-one/user',  // å­åº”ç”¨é¡µé¢ï¼Œpathè‡ªåŠ¨ä½œä¸ºkey
      icon: 'UserOutlined',
      type: 'micro',           // å­åº”ç”¨é¡µé¢
      appName: 'child-one',
      // childPath è‡ªåŠ¨æ¨å¯¼ï¼š/child-one/user -> /user
    },
    {
      label: 'é«˜çº§åŠŸèƒ½',        // èœå•ç»„æ— éœ€pathï¼Œè‡ªåŠ¨ç”Ÿæˆéšæœºkey
      icon: 'ExperimentOutlined',
      children: [              // ä¸‰çº§èœå•
        {
          label: 'ç³»ç»Ÿæ—¥å¿—',
          path: '/system/logs', // pathè‡ªåŠ¨ä½œä¸ºkey
          icon: 'FileTextOutlined',
          type: 'main',        // ä¸»åº”ç”¨é¡µé¢
        },
        {
          label: 'ç³»ç»Ÿç›‘æ§',
          path: '/child-two/monitor', // pathè‡ªåŠ¨ä½œä¸ºkey
          icon: 'MonitorOutlined',
          type: 'micro',       // å­åº”ç”¨é¡µé¢
          appName: 'child-two',
          // childPath è‡ªåŠ¨æ¨å¯¼ï¼š/child-two/monitor -> /monitor
        },
      ],
    },
  ],
}
```

## ä½¿ç”¨æ–¹å¼

### 1. æ·»åŠ æ–°çš„å­åº”ç”¨

éœ€è¦åœ¨ä¸¤ä¸ªåœ°æ–¹æ·»åŠ é…ç½®ï¼š

**1) åœ¨ `childApps` æ•°ç»„ä¸­æ·»åŠ å¾®å‰ç«¯é…ç½®ï¼š**

```javascript
{
  name: 'new-app', // å­åº”ç”¨åç§°ï¼Œå­åº”ç”¨ä¹‹é—´åç§°ä¸èƒ½é‡å¤
  url: 'http://localhost:8004',
  iframe: true, // vite é¡¹ç›®å¿…é¡»è®¾ç½®ä¸º true
  routePrefix: '/new-app', // èœå•é¡¹çš„è·¯ç”±å‰ç¼€ï¼Œå­åº”ç”¨ä¹‹é—´åç§°ä¸èƒ½é‡å¤ï¼Œæ¨è /+name
  port: 8004,
  enabled: true,
}
```

**2) åœ¨ `childAppRoutes` å¯¹è±¡ä¸­æ·»åŠ è·¯ç”±é…ç½®ï¼š**

```javascript
// åœ¨ childAppRoutes å¯¹è±¡ä¸­æ·»åŠ æ–°çš„å­åº”ç”¨è·¯ç”±é…ç½®
'new-app': {
  appName: 'new-app',
  title: 'æ–°åº”ç”¨',
  icon: 'AppstoreOutlined',
  children: [
    {
      key: 'new-app-home',
      label: 'é¦–é¡µ',
      path: '/new-app/home',
      childPath: '/',
      icon: 'HomeOutlined',
    },
    {
      key: 'new-app-about',
      label: 'å…³äº',
      path: '/new-app/about',
      childPath: '/about',
      icon: 'InfoCircleOutlined',
    },
    // æ”¯æŒäºŒçº§èœå•
    {
      key: 'new-app-admin',
      label: 'ç®¡ç†åŠŸèƒ½',
      children: [
        {
          key: 'new-app-admin-user',
          label: 'ç”¨æˆ·ç®¡ç†',
          path: '/new-app/admin/user',
          childPath: '/admin/user',
          icon: 'UserOutlined',
        }
      ]
    }
  ]
}
```

### 2. ä¿®æ”¹å­åº”ç”¨é…ç½®

ç›´æ¥ç¼–è¾‘ `app.config.ts` æ–‡ä»¶ä¸­å¯¹åº”çš„é…ç½®é¡¹ã€‚

### 3. ä¸´æ—¶ç¦ç”¨å­åº”ç”¨

å°†é…ç½®ä¸­çš„ `enabled` è®¾ç½®ä¸º `false`ã€‚

### 4. ä¿®æ”¹èœå•

åœ¨ `mainAppRoutes` æˆ– `childAppRoutes` æ•°ç»„ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤èœå•é¡¹ã€‚

## é…ç½®ç®¡ç†å™¨ API

```javascript
// è·å–æ‰€æœ‰å¯ç”¨çš„å­åº”ç”¨å¾®å‰ç«¯é…ç½®
microAppConfig.getChildApps()

// æ ¹æ®åç§°è·å–å­åº”ç”¨é…ç½®
microAppConfig.getChildAppByName('child-one')

// æ ¹æ®è·¯ç”±è·å–å­åº”ç”¨é…ç½®
microAppConfig.getChildAppByRoute('/child-one/home')

// è·å–ä¸»åº”ç”¨è·¯ç”±èœå•
microAppConfig.getMainAppRoutes()

// è·å–å¯ç”¨çš„å­åº”ç”¨è·¯ç”±èœå•
microAppConfig.getChildAppRoutes()

// æ ¹æ®å­åº”ç”¨åç§°è·å–å…¶è·¯ç”±é…ç½®
microAppConfig.getRoutesByAppName('child-one')

// è·å–æ‰€æœ‰èœå•é¡¹ï¼ˆä¸»åº”ç”¨ + å­åº”ç”¨ï¼‰
microAppConfig.getAllMenuItems()

// è·å–å­åº”ç”¨URL
microAppConfig.getChildAppUrl('/child-one/home')

// æ£€æŸ¥æ˜¯å¦ä¸ºå­åº”ç”¨è·¯ç”±
microAppConfig.isChildAppRoute('/child-one/home')

// è·å–å®Œæ•´é…ç½®
microAppConfig.getFullConfig()
```

## é…ç½®åˆ†ç¦»çš„ä¼˜åŠ¿

1. **èŒè´£åˆ†ç¦»**ï¼šå¾®å‰ç«¯é…ç½®å’Œè·¯ç”±é…ç½®å„å¸å…¶èŒï¼Œç»“æ„æ›´æ¸…æ™°
2. **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹è·¯ç”±ä¸å½±å“å¾®å‰ç«¯é…ç½®ï¼Œä¿®æ”¹å¾®å‰ç«¯é…ç½®ä¸å½±å“è·¯ç”±
3. **æ›´å¥½çš„æ‰©å±•æ€§**ï¼šå¯ä»¥ç‹¬ç«‹ç®¡ç†ä¸åŒç±»å‹çš„é…ç½®
4. **çµæ´»æ€§æ›´å¼º**ï¼šå¯ä»¥ä¸ºåŒä¸€ä¸ªå­åº”ç”¨é…ç½®å¤šä¸ªè·¯ç”±ï¼Œæˆ–è€…åŠ¨æ€è°ƒæ•´è·¯ç”±
5. **åˆ†ç»„ç®¡ç†**ï¼šå­åº”ç”¨è·¯ç”±æŒ‰åº”ç”¨åˆ†ç»„ï¼Œä¾¿äºç®¡ç†å’ŒæŸ¥æ‰¾
6. **æ”¯æŒå¤šçº§èœå•**ï¼šæ”¯æŒäºŒçº§èœå•ç»“æ„ï¼Œå¯ä»¥æ„å»ºæ›´å¤æ‚çš„å¯¼èˆªç»“æ„
7. **å±‚æ¬¡æ¸…æ™°**ï¼šæ¯ä¸ªå­åº”ç”¨çš„èœå•ç»“æ„ç‹¬ç«‹ï¼Œå±‚æ¬¡åˆ†æ˜

## æ³¨æ„äº‹é¡¹

1. ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨
2. ç¡®ä¿å­åº”ç”¨çš„ç«¯å£å·ä¸å†²çª
3. è·¯ç”±å‰ç¼€å¿…é¡»å”¯ä¸€
4. å›¾æ ‡åç§°éœ€è¦åœ¨ `layout.vue` ä¸­çš„ `iconMap` ä¸­å®šä¹‰
5. å­åº”ç”¨è·¯ç”±é…ç½®ä¸­çš„ `appName` å¿…é¡»ä¸å¯¹åº”çš„å­åº”ç”¨ `name` ä¸€è‡´
